<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CBT Examination</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
body{font-family:Arial,sans-serif;background:#f4f6f8;margin:0}
.container{max-width:900px;margin:40px auto;background:#fff;padding:24px;border-radius:8px}
button{padding:10px 18px;border:none;border-radius:6px;background:#0b3c5d;color:#fff;cursor:pointer}
button:disabled{background:#aaa}
.option{margin:8px 0}
.hidden{display:none}
</style>
</head>
<body>

<div class="container">
<h2>CBT Examination</h2>

<p>Candidate Name:</p>
<input type="text" id="name" style="width:100%;padding:8px" placeholder="Enter your name">

<br><br>
<button id="startBtn" disabled>Loading testâ€¦</button>

<hr>

<div id="exam" class="hidden">
<div id="status"></div>
<p id="stem"></p>
<div id="options"></div>

<br>
<button onclick="prevQ()">Previous</button>
<button onclick="nextQ()">Next</button>
<button onclick="submitExam()">Submit</button>
</div>

<div id="result"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyWsz_xaxTkKEJFt8DNB05iv1vv5XxDkGsmPfUK2eXrlvgNv7fMRfhFNeZVyIROaekA/exec";

let bank = [];
let current = 0;
let answers = {};

fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    bank = data;
    if (!bank || !bank.length) {
      alert("No items found. Check your Google Sheet.");
      return;
    }
    document.getElementById("startBtn").innerText = "Start Exam (" + bank.length + " items)";
    document.getElementById("startBtn").disabled = false;
  })
  .catch(err => {
    console.error(err);
    alert("Failed to load item bank.");
  });

function startExam(){
  if (!document.getElementById("name").value.trim()) {
    alert("Candidate name is required.");
    return;
  }
  document.getElementById("startBtn").classList.add("hidden");
  document.getElementById("exam").classList.remove("hidden");
  renderQ();
}

function renderQ(){
  const q = bank[current];
  document.getElementById("status").innerText = `Question ${current+1} / ${bank.length}`;
  document.getElementById("stem").innerText = q.Stem;

  let html = "";
  ["A","B","C","D"].forEach(o => {
    html += `
     <div class="option">
       <label>
         <input type="radio" name="opt" value="${o}"
           ${answers[current] === o ? "checked" : ""}
           onchange="answers[current]='${o}'">
         ${o}. ${q["Option"+o]}
       </label>
     </div>`;
  });
  document.getElementById("options").innerHTML = html;
}

function nextQ() {
  if (current < bank.length - 1) current++;
  renderQ();
}

function prevQ() {
  if (current > 0) current--;
  renderQ();
}

function submitExam(){
  let correctCount = 0;
  bank.forEach((q,i) => {
    if (answers[i] === q.Correct) correctCount++;
  });
  document.getElementById("exam").classList.add("hidden");
  document.getElementById("result").innerHTML = `
    <h3>Result</h3>
    Name: ${document.getElementById("name").value}<br>
    Total: ${bank.length}<br>
    Correct: ${correctCount}<br>
    Wrong: ${bank.length - correctCount}
  `;
}
</script>

</body>
</html>
